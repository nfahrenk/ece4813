import pymysql

USERNAME = 'root'
PASSWORD = 'password'
DB_NAME = 'DBPROJECT'
END_POINT = 'ece4813-project-rds.cvei3yvcg2ng.us-east-2.rds.amazonaws.com'

def get_ips():
    conn = pymysql.connect(host=END_POINT, port=3306, user=USERNAME, passwd=PASSWORD, db=DB_NAME)
    cur = conn.cursor()
    cur.execute("SELECT * FROM MyMalware;")
    conn.commit()
    result = cur.fetchall()
    cur.close()
    conn.close()

    x = [-180]
    y = [-90]

    for row in result:
        ip = str(row[7])
        if ip != 'None' and ip is not None:
            lon = str(row[8])
            lat = str(row[9])
            if len(lon) > 0 and len(lat) > 0:
                x.append(lon)
                y.append(lat)
            
        if len(x) == 9:
            x.append(180)
            y.append(90)
            return tuple([x, y])
        
    x.append(180)
    y.append(90)
    return tuple([x, y])

def lambda_handler(event, context):
    locations = get_ips()
    response = {
        'longitudes': locations[0],
        'latitudes': locations[1]
    }
    return response
